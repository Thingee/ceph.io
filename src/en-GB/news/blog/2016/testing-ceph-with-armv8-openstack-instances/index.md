---
title: "Testing Ceph with ARMv8 OpenStack instances"
date: "2016-04-07"
author: "admin"
tags: 
  - "planet"
---

The [Ceph integration tests](https://github.com/ceph/ceph-qa-suite) can be run on [ARMv8](https://en.wikipedia.org/wiki/ARM_architecture#ARMv8-A) (aka arm64 or aarch64) [OpenStack](http://openstack.org) instances on [CloudLab](http://cloudlab.us/) or [Runabove](https://www.runabove.com/armcloud.xml).

When logged in CloudLab an OpenStack cluster suitable for teuthology must be created. To [start an experiment](https://www.cloudlab.us/instantiate.php)

[![](images/cloudlab-1-1024x393.png "cloudlab-1")](http://dachary.org/wp-uploads/2016/04/cloudlab-1.png)

click **Change Profile**

[![](images/cloudlab-2.png "cloudlab-2")](http://dachary.org/wp-uploads/2016/04/cloudlab-2.png)

to select the [OpenStackTeuthology](https://www.cloudlab.us/show-profile.php?uuid=f7d3d396-f8e7-11e5-95f1-020cbce80001) profile

[![](images/cloudlab-4-1024x598.png "cloudlab-4")](http://dachary.org/wp-uploads/2016/04/cloudlab-4.png)

the description of the profile contains an example credential file (i.e. openrc.sh) that can be copy/pasted on the local machine

[![](images/cloudlab-6.png "cloudlab-6")](http://dachary.org/wp-uploads/2016/04/cloudlab-6.png)

the **m400** default machine type will select [ARMv8](https://www.cloudlab.us/hardware.php#utah) hardware

[![](images/cloudlab-7.png "cloudlab-7")](http://dachary.org/wp-uploads/2016/04/cloudlab-7.png)

in the last step, choose a name for the experiment. The openrc.sh file must be modified to reflect the chosen name because it shows in the URL of the authentication service. If a new experiment by the same name is run a month later, the same openrc.sh file can be used.

[![](images/cloudlab-8.png "cloudlab-8")](http://dachary.org/wp-uploads/2016/04/cloudlab-8.png)

the page is then updated to show the progress of the provisionning. Note that it takes about 15 minutes for it to complete: even when the page says the experiment is up, the OpenStack setup is still going on and need a few more minutes.

[![](images/cloudlab-9.png "cloudlab-9")](http://dachary.org/wp-uploads/2016/04/cloudlab-9.png)

Finally click on **Profile instructions** to display the link to the horizon dashboard and the password of the admin user (i.e. **configuring OpenStack inside your experiment, youâ€™ll be able to visit the OpenStack Dashboard WWW interface (approx. 5-15 minutes). Your OpenStack admin and instance VM password is randomly-generated by Cloudlab, and it is: 0905d783e7e7 .**).

[![](images/cloudlab-10.png "cloudlab-10")](http://dachary.org/wp-uploads/2016/04/cloudlab-10.png)

When the cluster is created, running the [smoke](https://github.com/ceph/ceph-qa-suite/tree/master/suites/smoke) integration tests for rados on jewel can be done with [ceph-workbench](http://ceph-workbench.readthedocs.org/)

ceph-workbench --verbose ceph-qa-suite --ceph jewel --suite smoke --filter rados

assuming the openrc.sh file has been set in ~/.ceph-workbench/openrc.sh. When the command returns, it displays the URL of the web interface

...
2016-04-07 11:25:57,625.625 DEBUG:paramiko.transport:EOF in transport thread
2016-04-07 11:25:57,628.628 INFO:teuthology.openstack:
pulpito web interface: http://128.110.155.162:8081/
ssh access           : ssh ubuntu@128.110.155.162 # logs in /usr/share/nginx/html

And when the test completes successfully it will show in green. Otherwise the logs of the failed tests can be downloaded and analyzed.

[![](images/cloudlab-11-1024x318.png "cloudlab-11")](http://dachary.org/wp-uploads/2016/04/cloudlab-11.png)

### CloudLab Eligibility

CloudLab is for academics and short term experiments for research purposes. Ceph developers are granted access and help maintain the [profile](https://www.cloudlab.us/show-profile.php?uuid=f7d3d396-f8e7-11e5-95f1-020cbce80001) that allows other CloudLab users to create and test Ceph clusters. If you are a Ceph developer, create an account on cloudlab and [apply for membership in the Ceph project](https://www.cloudlab.us/signup.php) : the project name is **Ceph**.

### Runabove Eligibility

Runabove is in Beta testing and only allows running two instances at this time.

### CloudLab improvements

The default OpenStack profile for CloudLab was used as a base and modified to give more space to instances, use a 4.2 kernel instead of the default 3.13, create a larger flavor for the compilation of Ceph packages and pre-create an image with a name suitable for teuthology. The details have been discussed April 6th, 2016 during the Ceph Developers Monthly meeting (see [the pad](http://pad.ceph.com/p/running-ceph-qa-suite-jobs-on-arm64) and [the planning](http://tracker.ceph.com/projects/ceph/wiki/CDM_06-APR-2016)). The contributions that are not Teuthology specific were contributed via [the mailing list](https://groups.google.com/forum/#!forum/cloudlab-users).

Future work include being able [to re-use standard images](https://cloud-images.ubuntu.com/xenial/current/) instead of using AMI/ARI/AKI that are custom made, using a 4.3 kernel which includes virtio-pci instead of virtio-mmio and allows to dynamically attach disks, create an experiment from the command line instead of the web interface (possibly via web scrapping).

For debug purposes, the following command line was used to chose a specific branch of ceph-qa-suite, teuthology, ceph and ceph-cm-ansible

teuthology-openstack --verbose 
    --teuthology-git-url http://github.com/dachary/teuthology 
    --teuthology-branch openstack 
    --ceph-qa-suite-git-url http://github.com/dachary/ceph-qa-suite 
    --suite-branch wip-archs 
    --key-filename ~/.ceph-workbench/teuthology-myself.pem 
    --key-name teuthology-myself 
    --ceph-git-url http://github.com/dachary/ceph 
    --ceph wip-arm64-jewel 
    --suite smoke 
    --filter rados ansible.yaml

Source: Dachary ([Testing Ceph with ARMv8 OpenStack instances](http://dachary.org/?p=3939))
