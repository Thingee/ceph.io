---
title: "ceph luminous版本限制osd的内存使用"
date: "2019-09-03"
author: "admin"
tags: 
  - "planet"
---

## 引言

ceph自从到了L版本以后，L版本的启用，对性能本身有了极大的提高，一直对这个比较不放心的就是内存的占用，刚开始的时候记得大量dd就可以把内存搞崩掉，这个应该是内部的设计逻辑需要更多的内存的占用

最近在做ARM版本的服务器的测试，机器为36盘位的机器，内存需要自然多，但是36盘位的机器，按之前想法是4G预留，那得需要144G内存了，这个还没有算迁移的时候的内存消耗，而很多时候，我们并不需要速度，只需要稳定就好

## 测试环境说明

测试环境比较简单，一台36盘位的arm机器，一台X86机器，通过万兆相连，设置集群为副本1，然后再X86上面通过rados命令进行测试  

## 限制前后对比

我们先按默认的来一组测试

用读取命令进行测试  

<table><tbody><tr><td class="code"><pre><span class="line">rados  -p rbd  -t <span class="number">64</span>  bench <span class="number">300</span>  seq  --run-name  <span class="number">4</span>Mt16</span><br><span class="line">···</span><br><span class="line"><span class="number">2019</span>-<span class="number">09</span>-<span class="number">03</span> <span class="number">15</span>:<span class="number">19</span>:<span class="number">20.478841</span> min lat: <span class="number">0.188154</span> max lat: <span class="number">0.658198</span> avg lat: <span class="number">0.227437</span></span><br><span class="line">  sec Cur ops   started  finished  avg MB/s  cur MB/s last lat(s)  avg lat(s)</span><br><span class="line">   <span class="number">20</span>      <span class="number">63</span>      <span class="number">5620</span>      <span class="number">5557</span>   <span class="number">1111.24</span>      <span class="number">1124</span>    <span class="number">0.223682</span>    <span class="number">0.227437</span></span><br><span class="line">   <span class="number">21</span>      <span class="number">63</span>      <span class="number">5901</span>      <span class="number">5838</span>   <span class="number">1111.84</span>      <span class="number">1124</span>    <span class="number">0.232894</span>      <span class="number">0.2274</span></span><br><span class="line">   <span class="number">22</span>      <span class="number">63</span>      <span class="number">6179</span>      <span class="number">6116</span>   <span class="number">1111.84</span>      <span class="number">1112</span>    <span class="number">0.210126</span>    <span class="number">0.227447</span></span><br><span class="line">   <span class="number">23</span>      <span class="number">63</span>      <span class="number">6459</span>      <span class="number">6396</span>   <span class="number">1112.19</span>      <span class="number">1120</span>    <span class="number">0.209931</span>    <span class="number">0.227353</span></span><br><span class="line">   <span class="number">24</span>      <span class="number">63</span>      <span class="number">6742</span>      <span class="number">6679</span>   <span class="number">1113.01</span>      <span class="number">1132</span>    <span class="number">0.210041</span>    <span class="number">0.227428</span></span><br><span class="line">   <span class="number">25</span>      <span class="number">63</span>      <span class="number">7023</span>      <span class="number">6960</span>   <span class="number">1113.44</span>      <span class="number">1124</span>    <span class="number">0.447199</span>    <span class="number">0.227417</span></span><br><span class="line">   <span class="number">26</span>      <span class="number">63</span>      <span class="number">7302</span>      <span class="number">7239</span>   <span class="number">1113.54</span>      <span class="number">1116</span>    <span class="number">0.213757</span>    <span class="number">0.227367</span></span><br><span class="line">   <span class="number">27</span>      <span class="number">63</span>      <span class="number">7585</span>      <span class="number">7522</span>   <span class="number">1114.19</span>      <span class="number">1132</span>    <span class="number">0.222248</span>    <span class="number">0.227416</span></span><br><span class="line">   <span class="number">28</span>      <span class="number">63</span>      <span class="number">7870</span>      <span class="number">7807</span>   <span class="number">1115.08</span>      <span class="number">1140</span>    <span class="number">0.198665</span>    <span class="number">0.227351</span></span><br><span class="line">   <span class="number">29</span>      <span class="number">63</span>      <span class="number">8148</span>      <span class="number">8085</span>   <span class="number">1114.97</span>      <span class="number">1112</span>    <span class="number">0.222645</span>    <span class="number">0.227402</span></span><br><span class="line">   <span class="number">30</span>      <span class="number">63</span>      <span class="number">8430</span>      <span class="number">8367</span>    <span class="number">1115.4</span>      <span class="number">1128</span>    <span class="number">0.205243</span>    <span class="number">0.227394</span></span><br><span class="line">   <span class="number">31</span>      <span class="number">63</span>      <span class="number">8707</span>      <span class="number">8644</span>   <span class="number">1115.16</span>      <span class="number">1108</span>     <span class="number">0.22508</span>    <span class="number">0.227397</span></span><br><span class="line">   <span class="number">32</span>      <span class="number">63</span>      <span class="number">8987</span>      <span class="number">8924</span>   <span class="number">1115.31</span>      <span class="number">1120</span>    <span class="number">0.198234</span>    <span class="number">0.227326</span></span><br><span class="line">   <span class="number">33</span>      <span class="number">63</span>      <span class="number">9267</span>      <span class="number">9204</span>   <span class="number">1115.41</span>      <span class="number">1120</span>    <span class="number">0.232074</span>    <span class="number">0.227447</span></span><br><span class="line">   <span class="number">34</span>      <span class="number">63</span>      <span class="number">9551</span>      <span class="number">9488</span>   <span class="number">1115.99</span>      <span class="number">1136</span>    <span class="number">0.230373</span>    <span class="number">0.227413</span></span><br><span class="line">   <span class="number">35</span>      <span class="number">63</span>      <span class="number">9829</span>      <span class="number">9766</span>   <span class="number">1115.88</span>      <span class="number">1112</span>    <span class="number">0.214755</span>    <span class="number">0.227405</span></span><br><span class="line">   <span class="number">36</span>      <span class="number">63</span>     <span class="number">10107</span>     <span class="number">10044</span>   <span class="number">1115.77</span>      <span class="number">1112</span>    <span class="number">0.233391</span>    <span class="number">0.227403</span></span><br><span class="line">   <span class="number">37</span>      <span class="number">63</span>     <span class="number">10390</span>     <span class="number">10327</span>   <span class="number">1116.18</span>      <span class="number">1132</span>    <span class="number">0.223244</span>    <span class="number">0.227412</span></span><br><span class="line">   <span class="number">38</span>      <span class="number">63</span>     <span class="number">10673</span>     <span class="number">10610</span>    <span class="number">1116.6</span>      <span class="number">1132</span>    <span class="number">0.221128</span>     <span class="number">0.22742</span></span><br><span class="line">···</span><br></pre></td></tr></tbody></table>

通过top看下内存占用  

<table><tbody><tr><td class="code"><pre><span class="line">Tasks: <span class="number">526</span> total,   <span class="number">1</span> running, <span class="number">237</span> sleeping,   <span class="number">0</span> stopped,   <span class="number">0</span> zombie</span><br><span class="line">%Cpu(s):  <span class="number">1.6</span> us,  <span class="number">1.5</span> sy,  <span class="number">0.0</span> ni, <span class="number">95.3</span> id,  <span class="number">1.5</span> wa,  <span class="number">0.0</span> hi,  <span class="number">0.1</span> si,  <span class="number">0.0</span> st</span><br><span class="line">KiB Mem : <span class="number">13316204</span>+total, <span class="number">31199616</span> free, <span class="number">10079264</span>+used,  <span class="number">1169792</span> buff/cache</span><br><span class="line">KiB Swap:        <span class="number">0</span> total,        <span class="number">0</span> free,        <span class="number">0</span> used. <span class="number">21086208</span> avail Mem </span><br><span class="line"></span><br><span class="line">    PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                      </span><br><span class="line">  <span class="number">43967</span> ceph      <span class="number">20</span>   <span class="number">0</span> <span class="number">4176384</span>   <span class="number">3.1</span>g  <span class="number">26624</span> S   <span class="number">1.3</span>  <span class="number">2.4</span>   <span class="number">0</span>:<span class="number">08.79</span> ceph-osd                     </span><br><span class="line">  <span class="number">43890</span> ceph      <span class="number">20</span>   <span class="number">0</span> <span class="number">4116992</span>   <span class="number">3.0</span>g  <span class="number">26688</span> S   <span class="number">1.0</span>  <span class="number">2.4</span>   <span class="number">0</span>:<span class="number">08.69</span> ceph-osd                     </span><br><span class="line">  <span class="number">43753</span> ceph      <span class="number">20</span>   <span class="number">0</span> <span class="number">4091712</span>   <span class="number">3.0</span>g  <span class="number">26752</span> S   <span class="number">2.3</span>  <span class="number">2.4</span>   <span class="number">0</span>:<span class="number">08.88</span> ceph-osd                     </span><br><span class="line">  <span class="number">43873</span> ceph      <span class="number">20</span>   <span class="number">0</span> <span class="number">4160000</span>   <span class="number">3.0</span>g  <span class="number">26688</span> S   <span class="number">2.0</span>  <span class="number">2.4</span>   <span class="number">0</span>:<span class="number">08.77</span> ceph-osd                     </span><br><span class="line">  <span class="number">43998</span> ceph      <span class="number">20</span>   <span class="number">0</span> <span class="number">4275776</span>   <span class="number">3.0</span>g  <span class="number">26688</span> S   <span class="number">2.3</span>  <span class="number">2.4</span>   <span class="number">0</span>:<span class="number">08.91</span> ceph-osd                     </span><br><span class="line">  <span class="number">43716</span> ceph      <span class="number">20</span>   <span class="number">0</span> <span class="number">4128960</span>   <span class="number">3.0</span>g  <span class="number">26688</span> S   <span class="number">2.3</span>  <span class="number">2.3</span>   <span class="number">0</span>:<span class="number">08.95</span> ceph-osd                     </span><br><span class="line">  <span class="number">43899</span> ceph      <span class="number">20</span>   <span class="number">0</span> <span class="number">3911232</span>   <span class="number">3.0</span>g  <span class="number">26688</span> S   <span class="number">1.7</span>  <span class="number">2.3</span>   <span class="number">0</span>:<span class="number">08.44</span> ceph-osd                     </span><br><span class="line">  <span class="number">44022</span> ceph      <span class="number">20</span>   <span class="number">0</span> <span class="number">4133120</span>   <span class="number">3.0</span>g  <span class="number">26752</span> S   <span class="number">2.0</span>  <span class="number">2.3</span>   <span class="number">0</span>:<span class="number">09.29</span> ceph-osd                     </span><br><span class="line">  <span class="number">43617</span> ceph      <span class="number">20</span>   <span class="number">0</span> <span class="number">4100608</span>   <span class="number">2.9</span>g  <span class="number">26688</span> S   <span class="number">2.6</span>  <span class="number">2.3</span>   <span class="number">0</span>:<span class="number">09.13</span> ceph-osd                     </span><br><span class="line">  <span class="number">43868</span> ceph      <span class="number">20</span>   <span class="number">0</span> <span class="number">4110016</span>   <span class="number">2.9</span>g  <span class="number">26688</span> S   <span class="number">2.6</span>  <span class="number">2.3</span>   <span class="number">0</span>:<span class="number">08.70</span> ceph-osd                     </span><br><span class="line">  <span class="number">43792</span> ceph      <span class="number">20</span>   <span class="number">0</span> <span class="number">4095552</span>   <span class="number">2.9</span>g  <span class="number">26752</span> S   <span class="number">2.3</span>  <span class="number">2.3</span>   <span class="number">0</span>:<span class="number">09.02</span> ceph-osd                     </span><br><span class="line">  <span class="number">43985</span> ceph      <span class="number">20</span>   <span class="number">0</span> <span class="number">4090368</span>   <span class="number">2.9</span>g  <span class="number">26624</span> S   <span class="number">2.3</span>  <span class="number">2.3</span>   <span class="number">0</span>:<span class="number">08.84</span> ceph-osd                     </span><br><span class="line">  <span class="number">43707</span> ceph      <span class="number">20</span>   <span class="number">0</span> <span class="number">4177472</span>   <span class="number">2.9</span>g  <span class="number">26624</span> S   <span class="number">2.3</span>  <span class="number">2.3</span>   <span class="number">0</span>:<span class="number">08.79</span> ceph-osd                     </span><br><span class="line">  <span class="number">44028</span> ceph      <span class="number">20</span>   <span class="number">0</span> <span class="number">4084288</span>   <span class="number">2.9</span>g  <span class="number">26624</span> S   <span class="number">2.3</span>  <span class="number">2.3</span>   <span class="number">0</span>:<span class="number">08.93</span> ceph-osd                     </span><br><span class="line">  <span class="number">43995</span> ceph      <span class="number">20</span>   <span class="number">0</span> <span class="number">4092480</span>   <span class="number">2.8</span>g  <span class="number">26688</span> S   <span class="number">2.3</span>  <span class="number">2.2</span>   <span class="number">0</span>:<span class="number">08.95</span> ceph-osd                     </span><br><span class="line">  <span class="number">43852</span> ceph      <span class="number">20</span>   <span class="number">0</span> <span class="number">4054528</span>   <span class="number">2.8</span>g  <span class="number">26752</span> S   <span class="number">3.6</span>  <span class="number">2.2</span>   <span class="number">0</span>:<span class="number">08.75</span> ceph-osd                     </span><br><span class="line">  <span class="number">44038</span> ceph      <span class="number">20</span>   <span class="number">0</span> <span class="number">3966528</span>   <span class="number">2.8</span>g  <span class="number">26688</span> S   <span class="number">2.6</span>  <span class="number">2.2</span>   <span class="number">0</span>:<span class="number">08.51</span> ceph-osd                     </span><br><span class="line">  <span class="number">43755</span> ceph      <span class="number">20</span>   <span class="number">0</span> <span class="number">4092096</span>   <span class="number">2.8</span>g  <span class="number">26752</span> S   <span class="number">3.0</span>  <span class="number">2.2</span>   <span class="number">0</span>:<span class="number">09.10</span> ceph-osd                     </span><br><span class="line">  <span class="number">43718</span> ceph      <span class="number">20</span>   <span class="number">0</span> <span class="number">4045376</span>   <span class="number">2.8</span>g  <span class="number">26688</span> S   <span class="number">1.3</span>  <span class="number">2.2</span>   <span class="number">0</span>:<span class="number">08.84</span> ceph-osd                     </span><br><span class="line">  <span class="number">43901</span> ceph      <span class="number">20</span>   <span class="number">0</span> <span class="number">3931648</span>   <span class="number">2.7</span>g  <span class="number">26688</span> S   <span class="number">1.7</span>  <span class="number">2.2</span>   <span class="number">0</span>:<span class="number">08.67</span> ceph-osd                     </span><br><span class="line">  <span class="number">43880</span> ceph      <span class="number">20</span>   <span class="number">0</span> <span class="number">4028992</span>   <span class="number">2.7</span>g  <span class="number">26688</span> S   <span class="number">2.6</span>  <span class="number">2.1</span>   <span class="number">0</span>:<span class="number">08.82</span> ceph-osd                     </span><br><span class="line">  <span class="number">43897</span> ceph      <span class="number">20</span>   <span class="number">0</span> <span class="number">3978752</span>   <span class="number">2.7</span>g  <span class="number">26624</span> S   <span class="number">2.3</span>  <span class="number">2.1</span>   <span class="number">0</span>:<span class="number">08.59</span> ceph-osd                     </span><br><span class="line">  <span class="number">43858</span> ceph      <span class="number">20</span>   <span class="number">0</span> <span class="number">4019776</span>   <span class="number">2.7</span>g  <span class="number">26560</span> S   <span class="number">1.3</span>  <span class="number">2.1</span>   <span class="number">0</span>:<span class="number">08.89</span> ceph-osd</span><br></pre></td></tr></tbody></table>

可以看到内存占用还是很可观的，我128G内存，基本要吃空了，内存需要的太大，还出现了无法分配内存的情况，我们限制下我们的内存

限制osd内存的参数  
默认值为

> osd\_memory\_target = 4294967296

我们限制到1G

> osd\_memory\_target = 1073741824

设置好了后重启下所有的osd

再来一轮测试

同样的命令  

<table><tbody><tr><td class="code"><pre><span class="line"><span class="number">2019</span>-<span class="number">09</span>-<span class="number">03</span> <span class="number">15</span>:<span class="number">28</span>:<span class="number">41.369259</span> min lat: <span class="number">0.189981</span> max lat: <span class="number">0.88615</span> avg lat: <span class="number">0.227472</span></span><br><span class="line">  sec Cur ops   started  finished  avg MB/s  cur MB/s last lat(s)  avg lat(s)</span><br><span class="line">   <span class="number">40</span>      <span class="number">63</span>     <span class="number">11232</span>     <span class="number">11169</span>   <span class="number">1116.67</span>      <span class="number">1116</span>    <span class="number">0.221146</span>    <span class="number">0.227472</span></span><br><span class="line">   <span class="number">41</span>      <span class="number">63</span>     <span class="number">11513</span>     <span class="number">11450</span>   <span class="number">1116.85</span>      <span class="number">1124</span>     <span class="number">0.22655</span>    <span class="number">0.227467</span></span><br><span class="line">   <span class="number">42</span>      <span class="number">63</span>     <span class="number">11794</span>     <span class="number">11731</span>   <span class="number">1117.01</span>      <span class="number">1124</span>    <span class="number">0.213789</span>    <span class="number">0.227451</span></span><br><span class="line">   <span class="number">43</span>      <span class="number">63</span>     <span class="number">12073</span>     <span class="number">12010</span>   <span class="number">1116.98</span>      <span class="number">1116</span>     <span class="number">0.21521</span>    <span class="number">0.227447</span></span><br><span class="line">   <span class="number">44</span>      <span class="number">63</span>     <span class="number">12353</span>     <span class="number">12290</span>   <span class="number">1117.05</span>      <span class="number">1120</span>    <span class="number">0.232574</span>    <span class="number">0.227455</span></span><br><span class="line">   <span class="number">45</span>      <span class="number">63</span>     <span class="number">12632</span>     <span class="number">12569</span>   <span class="number">1117.02</span>      <span class="number">1116</span>    <span class="number">0.217199</span>    <span class="number">0.227449</span></span><br><span class="line">   <span class="number">46</span>      <span class="number">63</span>     <span class="number">12917</span>     <span class="number">12854</span>   <span class="number">1117.52</span>      <span class="number">1140</span>    <span class="number">0.211747</span>    <span class="number">0.227425</span></span><br><span class="line">   <span class="number">47</span>      <span class="number">63</span>     <span class="number">13194</span>     <span class="number">13131</span>   <span class="number">1117.31</span>      <span class="number">1108</span>    <span class="number">0.229418</span>    <span class="number">0.227473</span></span><br><span class="line">   <span class="number">48</span>      <span class="number">63</span>     <span class="number">13476</span>     <span class="number">13413</span>   <span class="number">1117.52</span>      <span class="number">1128</span>    <span class="number">0.229639</span>    <span class="number">0.227456</span></span><br><span class="line">   <span class="number">49</span>      <span class="number">63</span>     <span class="number">13756</span>     <span class="number">13693</span>   <span class="number">1117.57</span>      <span class="number">1120</span>    <span class="number">0.228479</span>     <span class="number">0.22745</span></span><br><span class="line">   <span class="number">50</span>      <span class="number">63</span>     <span class="number">14041</span>     <span class="number">13978</span>      <span class="number">1118</span>      <span class="number">1140</span>     <span class="number">0.21689</span>    <span class="number">0.227463</span></span><br><span class="line">   <span class="number">51</span>      <span class="number">63</span>     <span class="number">14316</span>     <span class="number">14253</span>   <span class="number">1117.64</span>      <span class="number">1100</span>     <span class="number">0.23947</span>    <span class="number">0.227468</span></span><br><span class="line">   <span class="number">52</span>      <span class="number">63</span>     <span class="number">14599</span>     <span class="number">14536</span>   <span class="number">1117.92</span>      <span class="number">1132</span>    <span class="number">0.215251</span>    <span class="number">0.227452</span></span><br><span class="line">   <span class="number">53</span>      <span class="number">63</span>     <span class="number">14880</span>     <span class="number">14817</span>   <span class="number">1118.03</span>      <span class="number">1124</span>    <span class="number">0.227617</span>    <span class="number">0.227461</span></span><br><span class="line">   <span class="number">54</span>      <span class="number">63</span>     <span class="number">15160</span>     <span class="number">15097</span>   <span class="number">1118.05</span>      <span class="number">1120</span>    <span class="number">0.224964</span>    <span class="number">0.227449</span></span><br><span class="line">   <span class="number">55</span>      <span class="number">63</span>     <span class="number">15442</span>     <span class="number">15379</span>   <span class="number">1118.22</span>      <span class="number">1128</span>    <span class="number">0.219148</span>    <span class="number">0.227451</span></span><br><span class="line">   <span class="number">56</span>      <span class="number">63</span>     <span class="number">15721</span>     <span class="number">15658</span>   <span class="number">1118.18</span>      <span class="number">1116</span>    <span class="number">0.223736</span>    <span class="number">0.227459</span></span><br><span class="line">   <span class="number">57</span>      <span class="number">63</span>     <span class="number">16001</span>     <span class="number">15938</span>   <span class="number">1118.21</span>      <span class="number">1120</span>     <span class="number">0.23183</span>    <span class="number">0.227468</span></span><br><span class="line">   <span class="number">58</span>      <span class="number">63</span>     <span class="number">16282</span>     <span class="number">16219</span>    <span class="number">1118.3</span>      <span class="number">1124</span>    <span class="number">0.217697</span>    <span class="number">0.227465</span></span><br><span class="line">   <span class="number">59</span>      <span class="number">63</span>     <span class="number">16566</span>     <span class="number">16503</span>    <span class="number">1118.6</span>      <span class="number">1136</span>    <span class="number">0.217804</span>    <span class="number">0.227465</span></span><br></pre></td></tr></tbody></table>

查看修改后的内存占用  

<table><tbody><tr><td class="code"><pre><span class="line">top - <span class="number">15</span>:<span class="number">29</span>:<span class="number">10</span> up  <span class="number">4</span>:<span class="number">54</span>,  <span class="number">6</span> users,  load average: <span class="number">1.88</span>, <span class="number">2.74</span>, <span class="number">2.25</span></span><br><span class="line">Tasks: <span class="number">506</span> total,   <span class="number">1</span> running, <span class="number">239</span> sleeping,   <span class="number">0</span> stopped,   <span class="number">0</span> zombie</span><br><span class="line">%Cpu(s):  <span class="number">1.2</span> us,  <span class="number">0.9</span> sy,  <span class="number">0.0</span> ni, <span class="number">97.4</span> id,  <span class="number">0.0</span> wa,  <span class="number">0.0</span> hi,  <span class="number">0.4</span> si,  <span class="number">0.0</span> st</span><br><span class="line">KiB Mem : <span class="number">13316204</span>+total, <span class="number">12275264</span>+free,  <span class="number">9211264</span> used,  <span class="number">1198144</span> buff/cache</span><br><span class="line">KiB Swap:        <span class="number">0</span> total,        <span class="number">0</span> free,        <span class="number">0</span> used. <span class="number">11264793</span>+avail Mem </span><br><span class="line"></span><br><span class="line">    PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                      </span><br><span class="line">  <span class="number">48575</span> ceph      <span class="number">20</span>   <span class="number">0</span>  <span class="number">908544</span> <span class="number">262144</span>  <span class="number">26688</span> S   <span class="number">2.0</span>  <span class="number">0.2</span>   <span class="number">0</span>:<span class="number">09.71</span> ceph-osd                     </span><br><span class="line">  <span class="number">48547</span> ceph      <span class="number">20</span>   <span class="number">0</span>  <span class="number">904448</span> <span class="number">252800</span>  <span class="number">26752</span> S   <span class="number">1.0</span>  <span class="number">0.2</span>   <span class="number">0</span>:<span class="number">09.36</span> ceph-osd                     </span><br><span class="line">  <span class="number">48480</span> ceph      <span class="number">20</span>   <span class="number">0</span>  <span class="number">902336</span> <span class="number">247552</span>  <span class="number">26624</span> S   <span class="number">1.3</span>  <span class="number">0.2</span>   <span class="number">0</span>:<span class="number">09.11</span> ceph-osd                     </span><br><span class="line">  <span class="number">48485</span> ceph      <span class="number">20</span>   <span class="number">0</span>  <span class="number">906048</span> <span class="number">242048</span>  <span class="number">26688</span> S   <span class="number">1.7</span>  <span class="number">0.2</span>   <span class="number">0</span>:<span class="number">09.38</span> ceph-osd                     </span><br><span class="line">  <span class="number">48423</span> ceph      <span class="number">20</span>   <span class="number">0</span>  <span class="number">901312</span> <span class="number">241984</span>  <span class="number">26688</span> S   <span class="number">1.3</span>  <span class="number">0.2</span>   <span class="number">0</span>:<span class="number">09.62</span> ceph-osd                     </span><br><span class="line">  <span class="number">48534</span> ceph      <span class="number">20</span>   <span class="number">0</span>  <span class="number">896576</span> <span class="number">234752</span>  <span class="number">26688</span> S   <span class="number">1.3</span>  <span class="number">0.2</span>   <span class="number">0</span>:<span class="number">09.22</span> ceph-osd                     </span><br><span class="line">  <span class="number">48395</span> ceph      <span class="number">20</span>   <span class="number">0</span>  <span class="number">902656</span> <span class="number">231360</span>  <span class="number">26688</span> S   <span class="number">2.0</span>  <span class="number">0.2</span>   <span class="number">0</span>:<span class="number">08.96</span> ceph-osd                     </span><br><span class="line">  <span class="number">48474</span> ceph      <span class="number">20</span>   <span class="number">0</span>  <span class="number">899584</span> <span class="number">225920</span>  <span class="number">26624</span> S   <span class="number">1.3</span>  <span class="number">0.2</span>   <span class="number">0</span>:<span class="number">09.07</span> ceph-osd                     </span><br><span class="line">  <span class="number">48369</span> ceph      <span class="number">20</span>   <span class="number">0</span>  <span class="number">891456</span> <span class="number">223232</span>  <span class="number">26688</span> S   <span class="number">1.3</span>  <span class="number">0.2</span>   <span class="number">0</span>:<span class="number">09.31</span> ceph-osd                     </span><br><span class="line">  <span class="number">48375</span> ceph      <span class="number">20</span>   <span class="number">0</span>  <span class="number">899648</span> <span class="number">222016</span>  <span class="number">26624</span> S   <span class="number">1.7</span>  <span class="number">0.2</span>   <span class="number">0</span>:<span class="number">08.72</span> ceph-osd                     </span><br><span class="line">  <span class="number">48365</span> ceph      <span class="number">20</span>   <span class="number">0</span>  <span class="number">885312</span> <span class="number">220928</span>  <span class="number">26688</span> S   <span class="number">1.3</span>  <span class="number">0.2</span>   <span class="number">0</span>:<span class="number">09.06</span> ceph-osd                     </span><br><span class="line">  <span class="number">48421</span> ceph      <span class="number">20</span>   <span class="number">0</span>  <span class="number">899200</span> <span class="number">218944</span>  <span class="number">26688</span> S   <span class="number">1.7</span>  <span class="number">0.2</span>   <span class="number">0</span>:<span class="number">09.31</span> ceph-osd                     </span><br><span class="line">  <span class="number">48478</span> ceph      <span class="number">20</span>   <span class="number">0</span>  <span class="number">889344</span> <span class="number">218496</span>  <span class="number">26880</span> S   <span class="number">1.3</span>  <span class="number">0.2</span>   <span class="number">0</span>:<span class="number">09.46</span> ceph-osd                     </span><br><span class="line">  <span class="number">48347</span> ceph      <span class="number">20</span>   <span class="number">0</span>  <span class="number">879104</span> <span class="number">218112</span>  <span class="number">26688</span> S   <span class="number">1.7</span>  <span class="number">0.2</span>   <span class="number">0</span>:<span class="number">08.52</span> ceph-osd                     </span><br><span class="line">  <span class="number">48515</span> ceph      <span class="number">20</span>   <span class="number">0</span>  <span class="number">891456</span> <span class="number">215680</span>  <span class="number">26688</span> S   <span class="number">2.0</span>  <span class="number">0.2</span>   <span class="number">0</span>:<span class="number">09.21</span> ceph-osd                     </span><br><span class="line">  <span class="number">48465</span> ceph      <span class="number">20</span>   <span class="number">0</span>  <span class="number">884224</span> <span class="number">214336</span>  <span class="number">26688</span> S   <span class="number">1.7</span>  <span class="number">0.2</span>   <span class="number">0</span>:<span class="number">08.82</span> ceph-osd                     </span><br><span class="line">  <span class="number">48560</span> ceph      <span class="number">20</span>   <span class="number">0</span>  <span class="number">892480</span> <span class="number">214144</span>  <span class="number">26624</span> S   <span class="number">1.3</span>  <span class="number">0.2</span>   <span class="number">0</span>:<span class="number">08.87</span> ceph-osd                     </span><br><span class="line">  <span class="number">48552</span> ceph      <span class="number">20</span>   <span class="number">0</span>  <span class="number">900992</span> <span class="number">213952</span>  <span class="number">26752</span> S   <span class="number">1.7</span>  <span class="number">0.2</span>   <span class="number">0</span>:<span class="number">09.32</span> ceph-osd                     </span><br><span class="line">  <span class="number">48599</span> ceph      <span class="number">20</span>   <span class="number">0</span>  <span class="number">890432</span> <span class="number">213760</span>  <span class="number">26624</span> S   <span class="number">2.0</span>  <span class="number">0.2</span>   <span class="number">0</span>:<span class="number">09.19</span> ceph-osd                     </span><br><span class="line">  <span class="number">48613</span> ceph      <span class="number">20</span>   <span class="number">0</span>  <span class="number">882176</span> <span class="number">213056</span>  <span class="number">26752</span> S   <span class="number">1.0</span>  <span class="number">0.2</span>   <span class="number">0</span>:<span class="number">09.12</span> ceph-osd                     </span><br><span class="line">  <span class="number">48430</span> ceph      <span class="number">20</span>   <span class="number">0</span>  <span class="number">893440</span> <span class="number">212672</span>  <span class="number">26688</span> S   <span class="number">1.7</span>  <span class="number">0.2</span>   <span class="number">0</span>:<span class="number">09.18</span> ceph-osd                     </span><br><span class="line">  <span class="number">48503</span> ceph      <span class="number">20</span>   <span class="number">0</span>  <span class="number">885312</span> <span class="number">211456</span>  <span class="number">26688</span> S   <span class="number">2.3</span>  <span class="number">0.2</span>   <span class="number">0</span>:<span class="number">09.52</span> ceph-osd                     </span><br><span class="line">  <span class="number">48444</span> ceph      <span class="number">20</span>   <span class="number">0</span>  <span class="number">889408</span> <span class="number">211200</span>  <span class="number">26752</span> S   <span class="number">2.0</span>  <span class="number">0.2</span>   <span class="number">0</span>:<span class="number">09.60</span> ceph-osd                     </span><br><span class="line">  <span class="number">48635</span> ceph      <span class="number">20</span>   <span class="number">0</span>  <span class="number">898624</span> <span class="number">210944</span>  <span class="number">26688</span> S   <span class="number">2.0</span>  <span class="number">0.2</span>   <span class="number">0</span>:<span class="number">09.26</span> ceph-osd                     </span><br><span class="line">  <span class="number">48526</span> ceph      <span class="number">20</span>   <span class="number">0</span>  <span class="number">898624</span> <span class="number">210752</span>  <span class="number">26816</span> S   <span class="number">2.6</span>  <span class="number">0.2</span>   <span class="number">0</span>:<span class="number">09.20</span> ceph-osd                     </span><br><span class="line">  <span class="number">48491</span> ceph      <span class="number">20</span>   <span class="number">0</span>  <span class="number">898368</span> <span class="number">210304</span>  <span class="number">26816</span> S   <span class="number">2.3</span>  <span class="number">0.2</span>   <span class="number">0</span>:<span class="number">09.57</span> ceph-osd</span><br></pre></td></tr></tbody></table>

可以看到内存控的好好的，并且在这个场景下面，我们的性能并没有太多的损失，基本一致的，因为我的环境是单万兆的，输出的网络带宽是小于底层磁盘可以提供的带宽的，这个情况下磁盘的占用也就没那么满

这个也是我在做配置的时候推荐的一点，各项资源不要打的那么满，对于带宽场景来说，多留几个磁盘的输出冗余，那么在出现一些异常的时候，底层也不会影响到那么大

## 总结

本篇通过一个参数的介绍，讲述了osd的内存的占用的控制，一般情况来说，默认的参数已经足够好了，当然你在很确定你修改的参数会影响什么的情况下，可以根据需要做一些调整，如果在你的IO模型下面，你调整了都看不到效果，那还是不动为好

博客很久没写，杂事太多，事情最终还是要人去做的，否则落不了地

即使你是三星这样的大厂也会出现  
[https://developer.samsung.com/galaxy-watch/design/watch-designer](https://developer.samsung.com/galaxy-watch/design/watch-designer)  
这样一个设计工具下载链接，点击下载后反复循环加载的问题，网上看到有人说过这个问题，然而无解

我们手上有高性能的arm，就是上面的这款测试用到的，有32个processor，内存最大可以支持到  

<table><tbody><tr><td class="code"><pre><span class="line">Maximum Capacity: <span class="number">512</span> GB</span><br><span class="line">Number Of Devices: <span class="number">16</span></span><br></pre></td></tr></tbody></table>

盘位的机箱我们有能力自己设计，也就是可以根据需要进行定制，有需要的可以找我，可以在公司赚点提成费用

## 变更记录

| Why | Who | When |
| --- | --- | --- |
| 创建 | 武汉-运维-磨渣 | 2018-09-03 |

Source: zphj1987@gmail ([ceph luminous版本限制osd的内存使用](http://www.zphj1987.com/2019/09/03/ceph-luminous-limit-mem/))
